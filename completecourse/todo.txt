// TODO: does each Firebase request count as a "connection" (limited to 100) [also: why so many connections? 10 realtime users = 100 Firebase users?]
// TODO: system for bypassing cache or alerting customers to reload (Rhapsody-style)?
// TODO: iOS TOC syncing to TOC is doing some strange scrolling
// TODO: see if there are extra pages being pushed into the browser history that can be eliminated to make "Back" more streamlined
// TODO: sometimes the quizzerator doesn't seem to initialize with data
// TODO: Habitat quizzes do not seem to be loading in Safari (iOS or Mac)
// TODO: test fallback when Firebase errors out due to max concurrent users
// TODO: think about security considerations for user data (logged in? using id? more?)
// TODO: test transcript/captioning [check]/quizzes on iOS
// TODO: use latest videojs?
// TODO: when comments are visible, reduce margin-left of iframe-holder's child div to 0 and size comment panel to fit remaining area (with min-width)
// TODO: after updates are made, how will the "completion tracking" cope with toc indexes having changed numbers? [internal id's generated by the converter or from Habitat?]
// TODO: wide images don't fit in the zoomed popup
// TODO: when scrolling through content, check off sections that might not have triggered the usual "completed" scrolling trigger (ie, check for sequential completions)
// TODO: short sub-sections don't get marked complete

////////////////////////////////////////////////////////////////////////////

// DONE: get sample course to load and work correctly on InformIT the same way the test page does
// DONE: make the same code work locally and on InformIT
// DONE: multiple test courses in subfolders under "completecourse"?
// DONE: expand/collapse button is no longer working
// DONE: tag new content and process via converter (.rr-updated and .rr-update)
// DONE: shouldn't images be zoomable?
// DONE: better tracking of the TOC via headers
// DONE: check to see Habitat output headers can be tracked in the TOC for scrolling purposes
// DONE: add a "previous section" button/header
// DONE: make the previous button return the first section with the new src (as opposed to the last section with that new src)
// DONE: re-implement TOC searching
// TODONT: Habitat external resource upload (or just link) capability [link to S3]
// TODONT: test server options? (completecourse folder?) [completecourse]
// DONE: implement content searching (using pre-created index, ala HCW, using lunr)
// DONE: finish searching and refactor the loading of the index file (as .json, preferably?) [left it as .js for simplicity]
// DONE: when switching to new sections via an anchor, it doesn't actually take you to the anchor [line was commented out?!]
// DONE: handle not finding a search_index.js
// DONE: instead of using metadata, build a new flattened metadata with short "depth" labels, etc.
// DONE: put searching back in for videos [titles without search index]
// DONE: fall-back to other video formats (or does VideoJS do this automatically?)
// DONE: for videos, don't mark complete when switching (it does that now for text content, for lack of "scroll checking")
// DONE: (video) open with a title screen
// DONE: "short" labels for Habitat content look wrong now (see: Unleashed; video conversion artifact?)
// DONE: put chapter identifier in search result
// DONE: refactor TOC to add container for both regular TOC and search results?
// DONE: only mark child objects "started" (so parents don't mark their children)
// DONE: don't scroll search results (if they're visible)
// DONE: responsive: show/hide full-screen
// DONE: when xs and toc is clicked, hide toc
// DONE: responsive: do something with search and account buttons and hide project text
// DONE: Safari browser compatibility (video poster centering) [-wekbit prefix]
// DONE: collapse all button not working
// DONE: full-text searching: close search, # of hits
// DONE: start with table of contents collapsed
// DONE: load and display from CodeMantra (?) ePub
// DONE: test CodeMantra epub on S3 [check] and then InformIT [OEBPS needs to be lowercase]
// DONE: toc clicks and link clicks add to browser history [maybe not link clicks]
// DONE: jumping to a link from within a CodeMantra ePub works but then scrolls to the top of the new page
// DONE: for ePubs, make sure it can track sections [h4 too]
// DONE: make identification of current section visually nicer-looking
// DONE: change history during scrolling of sections
// DONE: finish styling full-text search UI (re-do search, prev/next hit)
// DONE: store localStorage data separately for each title (because localStorage is shared by domain)
// DONE: Google Analytics [I think so]
// DONE: designate start page for ePub? [hand edit]
// DONE: when scrolling, expand TOC for current section, if hidden
// DONE: if a TOC entry has no number, it's not expandable (like the Prologue) [clicking on entry expands it]
// DONE: search isn't grabbing the right text (ex: ch08lev1sec3 should be Working with Chat Hangouts, and not include the text "Admin Console") [n-1 problem, I think]
// DONE: setSearchIndex is being called before TOCTree is initialized [not seeing this anymore; localStorage issue?]
// DONE: expanding/collapsing arrows get confused (by auto-expanding)
// DONE: clicking on Index doesn't jump to the index page [iframe links don't set the iframe's src]
// DONE: bug when clicking on Chapter 7, then Index, links do not work, page just jumps [try not unloading the iframe?] [does not happen in Safari!] [iFrame with hash causes jumping in Chrome]
// DONE: when scrolling, look for sections in the current file to sync (not everywhere, in case section names are duplicated)
// DONE: search result toc #s should match the chapter numbers (not internal numbers)
// DONE: make default font sans
// DONE: highlight search term on page, with next/prev button in search box
// DONE: auto-expanding the TOC doesn't seem to work (on server) [seems ok]
// DONE: (BUG) new Habitat projects open to video page at first (? localStorage bug?) [seems ok]
// DONE: replace the timeout in iframe-holder's height checking with imagesLoaded, etc to avoid the height flicker/readjustment
// DONE: make ePub images clickable
// DONE: next/prev in search use the currently selected item (if any)
// DONE: item completion should be visible for "parent" items too (esp. videos) [still not crazy about the toc styling]
// DONE: click toc heading toggles it [might get overridden by auto-opening based on content scrolling]
// DONE: completion of parent in TOC is only checked if all children have been checked [cosmetic only; each section can be complete but displays half-complete symbol until all children are complete]
// DONE: clicking on TOC headings still toggles incorrectly sometimes [VideoManager.syncTOCToContent opens current content]
// DONE: for epubs, load toc from tocncx.html (instead of toc.ncx) because Firefox refused to follow the redirect [302 status: "moved"]
// DONE: external links need to be NOT overridden
// DONE: demo updated/changed content for Greg [deleted content = rollover to see; deleted chapter; change log]
// TODONT: send page title to Google Analytics (not link #) [it's there: Secondary dimension: Screen Name]
// DONE: max-width for iframe for better readability?
// DONE: better way to grab numbers for the TOC
// DONE: spell out the TOC numbering strategies for various styles/skins (data loading, toctree; habitat, epub, CIB skin) [Google Doc]
// DONE: sizing of Habitat content with quizzes/widgets isn't correct (CIB InDesign 1.5)
// DONE: widgets that resize the page need to be accounted for (CIB InDesign 18.7.1)
// DONE: xs needs a very small margin
// DONE: xs isn't set when first loaded
// DONE: smoother visual transition to new pages
// DONE: visual indicator that a page is loading
// DONE: download option for video toc entries
// DONE: hide codeMantra "click here to view the code" links
// DONE: visual indicator that a TOC entry has children
// DONE: toggling dropper when selecting an entry isn't working
// DONE: add optional closed captioning file to the toc.js
// DONE: where did the video BackButton go? (lost with change away from video.dev.js?) [yes]
// DONE: search for video has a bug? [Web Editions UI]
// DONE: zipfile downloading for video, best method? [iframe with file as src, downloads automatically]
// DONE: videos don't seem to be marking as "complete" [2nd level with short labels; moved completion marks to absolute, right of description (might overlap download buttons sometimes)]
// DONE: resize quiz iframes after loading [min-height = window height]
// DONE: make quiz iframes go away when clicking on another section
// DONE: event for Captivate quiz being completed? [found a way to get the % score of the quiz]
// DONE: track download link clicks
// DONE: new TOC styling: can hanging indents work?
// INFO: to preview a web edition, use this URL: https://memberservices.informit.com/my_account/webedition/[isbn]/html/index.html
// DONE: tighten up TOC look and feel (maybe: a's without tree-toggler don't have to be padded so far to the right)
// DONE: in new TOC: completion buttons are overlapping (or being loaded too many times)
// DONE: in both old and new TOC stylings: download button click area is way too big [default functionality of a label element; switched to a div]
// DONE: video title header TOC entries without video should be obvious [made them toggle the section]
// DONE: non-video header TOC entries should not be completed (until children are all completed) [need to test if children completing it works]
// DONE: added breakout_of_frame to avoid iframe scrolling issues on iPad (and possibly other issues)
// TODONT: come up with a way to make images approximately the same scale [production ppi issue]
// DONE: associating a comment with a text position [uses currentIndex]
// DONE: count of comments for page and whole title
// DONE: make page tab active
// DONE: comments not always loaded in sync with iframe
// DONE: make sure new posts automatically are added to the margins
// DONE: load comments per title
// DONE: only show "ok" comments
// DONE: associating a comment with a video (or chapter/toc entry?)
// DONE: clickable comments (take you to that toc entry)
// DONE: remove anchor hash (get it from videomanager on the fly)
// DONE: id for each toc entry
// DONE: require signon for comments (anonymous) and protect editing of "ok" field
// DONE: enable comments only for titles with the correct setup parameters [manifest.js: allowComments: true]
// TODONT: the Unleashed CSS causes an ugly scrolling jump when a new iframe section is loaded via infinite scrolling [no infinite scrolling]
// DONE: comments for "This Section" don't seem to be correctly accounted for
// DONE: drop-down for category of comment (optional): Tech Support, Author Feedback, General
// DONE: show category and reference TOC name in comment
// DONE: test commenting refresh in ePub titles (on tab switching, content switching, new comments loading)
// DONE: reply feature for comments (ie, nested comments)
// DONE: "comment pending" placeholder
// DONE: web interface for ok'ing comments
// DONE: new comments do not show up real-time in moderator
// DONE: comment sorting
// DONE: quiz score along the left margin, sticky
// DONE: animate correct/incorrect icons (they may need to be wrapped in a div to work with animate.css) [still not centered on icon but it's acceptable]
// DONE: "check all" button? (make it appear after 1/2 second)
// DONE: remediation / hint when incorrect response is checked
// DONE: save responses
// DONE: syncTOCToContent needs to be reworked for new scrolling
// DONE: syncTOCToContent takes a LONG time on some titles (like the Adobe Illustrator CIB 9780134382548)
// DONE: scrolling to links doesn't work now
// DONE: test all versions with new iframe scrolling logic
// DONE: links within Illustrator CIB do not work (link paths had relative path shortcuts and .xhtml)
// DONE: eliminate sizeToFitToBottom()
// DONE: sections with ampersands (&) in them do not get marked complete
// DONE: quizzerator: save quiz correct answers (ie, complete)
// DONE: make sure quiz responses get saved in a unique location for Web Editions (within the Database item, perhaps?) [nope, used postMessage to communicate between windows because they were on separate domains and not allowed to share code]
// DONE: switching between quiz and video isn't catching the change in src
// DONE: use filename of quiz for its id [can also be in the json data]
// DONE: quiz titles?
// DONE: remediation links to TOC entries in Web Edition [use text of src or video of desired TOC entry]
// DONE: load quizzerator into iframe via javascript
// DONE: fix styling and initial load of quizzerator (code now loads into iframe-holder's code space not its own, which affects jquery's $; and css paths are hard-coded to server)
// NOTE: you can't mess with code from iframes loaded from other domains; jquery loaded in other frames does not share the code space, not even scrolling code as for affix
// DONE: comments trying to use VideoManager before it's ready (instantiate Comments after video-manager)
// DONE: affix isn't working when loading content into frame; timing? (see NOTE above)
// DONE: use TOC entry for quiz title
// DONE: intra-page scrolling doesn't work on iPad; desktop (body) vs iOS (the-iframe-holder) scrolling
// NOTE: stashed an attempt to load html content into a DIV instead of an iframe but the Inkling CSS overrides proved overwhelming
// DONE: iOS jumps back to top of page when loading (related to the non-scrolling-at-first problem) [it was animate.css; disabled it for the iframe appearance on iOS]
// DONE: on iOS, setSearchIndex on toc-tree is being called before it's initialized [added timeout retry]
// TODONT: iOS pages don't scroll at first load (resetting iframe overflow corrects it; a pain in the ass to correct, ignoring since it corrects itself on successive clicks)
// DONE: private browsing on iPad doesn't work because localStorage is required (might be able to catch exceptions and ignore)
// DONE: closed captioning transcript (in sidebar?)
// DONE: video: in IE, it doesn't seem to restart with the time position you left off [can't remember why that stopped working]
// DONE: transcript highlights as video plays
// DONE: transcript scrolls automatically
// DONE: transcript on/off button
// DONE: jump to transcript links [test online]
// TODONT: keep captions and/or transcript on once they've been turned on [no need to; using the same player so all options remain active]
// DONE: transcript search field (or just use the main search box) [main search]
// DONE: search closed captioning, to supplement TOC search (prebuild search index during conversion) [replaces TOC search]
// DONE: video transcript search results should populate TOC search result window
// DONE: load quizzerator from tsv rather than json
// DONE: use checks and x's instead of thumbs
// DONE: have setting for review after each (yes/no)
// DONE: animate the appearance of the transcript
// DONE: see if this is unique per user: $(window.opener.document).find("meta[name='WT.dcsvid']") [it appears to be]
// DONE: figure out sequence of saveToRemote and loadFromRemote [don't save until we've tried to load at least once]
// DONE: optimize completion items when storing to Firebase via Database
// TODONT: "updated" or "new" icons in TOC (from converter; make sure I haven't already done it!) [I'd already done it]
// TODONT: contents-at-a-glance "Part" links don't work [broken links from Habitat]
// DONE: Firefox doesn't scrollToHash correctly [used html and body for scrollTop]
// DONE: upgrade to WebStorm 11?
// DONE: ignore "Appendix" of Habitat ABG titles
// DONE: improve numbering for Habitat ABG
// DONE: use a different method for loading the viewer_template so we don't get this error: XMLHttpRequest cannot load https://s3.amazonaws.com/storefronts/streaming-video/completecourse/js/viewer_template.html. No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'https://memberservices.informit.com' is therefore not allowed access.
// NOTE: switched from require|text to $.load for loading the viewer_template.html; hopefully this will prevent some of the cross-origin refresh problems.
// TODONT: make all images the same scale?? [can't be done my end]
// DONE: save timestamp with status and only overwrite if older
// DONE: account "stats" page (consecutive days read, # of titles, completion %)
// DONE: only one panel (account or comments) open at a time
// DONE: activate comments everywhere (for logged-in users)
// DONE: add customer id to comment record
// DONE: comments not working for Habitat content
// DONE: remove "."'s from Firebase keys (and added to Common.js)
// DONE: show name of page comment will be linked to
// NOTE: problems with iFrameResizer: it broke hash navigation; momentum scrolling issues in Safari [though it did work on iOS]
// DONE: set iframe height to contents [using inelegant setInterval rather than looking for all the various content & orientation changes]
// DONE: on iOS, pages scroll back to top (randomly?) [Habitat titles only, it seems; pages with video only??] [see InDesign, Chapter 1, Lesson Overview]
// DONE: Captivate quizzes need special size-to-fit logic
// DONE: quizzerator tsv data wasn't being allowed to load in Safari or Firefox (!); switching to .js data format loaded by iframe-holder [requirejs!text wasn't working in Safari]
// DONE: test new, new scrolling with Habitat, ePub, and CCNA [on Chrome, Safari, Firefox, IE11 (Windows)]
// DONE: quizzerator summary wasn't working with new scrolling; try having the habitat-body scroll on desktop and iOS
// DONE: show customer server email address when tech support comment is clicked [tech support web form]
// DONE: show TOC when search is initiated
// DONE: quiz spreadsheet "Download" button should regenerate download info
// DONE: htmlEscape the TOC titles (in case they have <, >, etc. in them)
// DONE: consolidate CUP styles into one place (and preferably add that file to the Habitat projects (?) [didn't see a good way, without Sass available in the projects])
// DONE: quizzes should only be marked complete when 100%
// DONE: image support for quizzerator questions and answers
// DONE: "New" badge for images is bold and off-center
// DONE: add pdf support (using browser-supported embed tag)
// DONE: responsive sizing (ResponsiveBootstrapToolkit) stopped working (?!) [had to tweak it to initialize after rewriting DOM]
// DONE: trying again with full-page scrolling with static elements [complete 4/1/16]
// NOTE: scrolling issues: iPad; desktop; Safari in general; extra IE scrollbars; after full-screen video plays; affix (iframe awareness of scroll position); PDF sizing; scrollable after PDF viewing; iOS pages with video; jumping to internal links; Captivate sizing
// DONE: save multiple responses (if allowed) in quizzerator
// DONE: quizzerator "start over" button
// DONE: quizzerator tracking: response click, restart click, check-all click with score
// DONE: why aren't TOC download buttons aligned (ex: 9780134505848)
// DONE: quizzerator: "randomize response" option
// DONE: quizzerator saving the correct user response, even if response order is randomized [using original load order as data-index]
// DONE: check for double-scrollbars in IE with current scrolling paradigm [looks ok, 4/8/16]
// DONE: does the quizzerator export refresh with each push of the download button?
// DONE: option to add "buy button" to header [manifest.js: buyButton: "<ISBN>"]
// DONE: style .toc with more specificity to avoid problems with Microsoft
// DONE: flag sample links in the TOC [toc.js: disabled: true, free: true; paywall.html in the title directory]
// DONE: get rid of top search box for Microsoft
// DONE: turn off comments and account page for Microsoft
// DONE: add checkbox for "Sample Mode?" to video-toc-converter
// DONE: system for using Habitat widgets in video courses? [can use exported HTML -or- use the slightly-modified flashcardset widget]
// DONE: consolidate widgets so one codebase can be used for Habitat and Web Editions/VOSP